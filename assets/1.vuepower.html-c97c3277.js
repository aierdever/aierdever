import{_ as n,p as s,q as a,J as p}from"./framework-d4dfb5a8.js";const t="/docs/market/power-1.png",e="/docs/market/power-2.png",o="/docs/market/power-3.png",l="/docs/market/power-4.png",r={},c=p('<h2 id="设计思路" tabindex="-1"><a class="header-anchor" href="#设计思路" aria-hidden="true">#</a> 设计思路</h2><p><img src="'+t+'" alt="设计思路"></p><h3 id="权限配置页面" tabindex="-1"><a class="header-anchor" href="#权限配置页面" aria-hidden="true">#</a> 权限配置页面</h3><ul><li>权限定义 <img src="'+e+'" alt="权限定义"></li><li>权限分配 <img src="'+o+`" alt="权限分配"></li></ul><h3 id="权限列表数据结构" tabindex="-1"><a class="header-anchor" href="#权限列表数据结构" aria-hidden="true">#</a> 权限列表数据结构：</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">[</span>
	<span class="token punctuation">{</span>
	  <span class="token literal-property property">moduleCode</span><span class="token operator">:</span> <span class="token string">&quot;Index-01&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">moduleIcon</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;1574223656584900609&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">permCode</span><span class="token operator">:</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">moduleId</span><span class="token operator">:</span> <span class="token string">&quot;1574223656551346178&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">permName</span><span class="token operator">:</span> <span class="token string">&quot;查&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">moduleGrade</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">moduleUrl</span><span class="token operator">:</span> <span class="token string">&quot;#&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> 
	<span class="token punctuation">{</span>
	  <span class="token literal-property property">moduleCode</span><span class="token operator">:</span> <span class="token string">&quot;AmscpOfficeAssets&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">moduleIcon</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;1574303201684934658&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">permCode</span><span class="token operator">:</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">moduleId</span><span class="token operator">:</span> <span class="token string">&quot;1574303201655574529&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">permName</span><span class="token operator">:</span> <span class="token string">&quot;查&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">moduleGrade</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">moduleUrl</span><span class="token operator">:</span> <span class="token string">&quot;/office-items&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> 
	<span class="token punctuation">{</span>
	  <span class="token literal-property property">moduleCode</span><span class="token operator">:</span> <span class="token string">&quot;Office-02&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">moduleIcon</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;1574300913255895042&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">permCode</span><span class="token operator">:</span> <span class="token string">&quot;view&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">moduleId</span><span class="token operator">:</span> <span class="token string">&quot;1574300913226534914&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">permName</span><span class="token operator">:</span> <span class="token string">&quot;查&quot;</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">moduleGrade</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> 
	  <span class="token literal-property property">moduleUrl</span><span class="token operator">:</span> <span class="token string">&quot;/office&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="技术实现" tabindex="-1"><a class="header-anchor" href="#技术实现" aria-hidden="true">#</a> 技术实现</h2><h3 id="登录" tabindex="-1"><a class="header-anchor" href="#登录" aria-hidden="true">#</a> 登录</h3><p>=&gt; <strong>用户账号信息</strong> =&gt; <strong><code>Token</code> 及相关令牌</strong> =&gt; <strong>拿回用户权限</strong></p><h3 id="路由控制" tabindex="-1"><a class="header-anchor" href="#路由控制" aria-hidden="true">#</a> 路由控制</h3><ul><li>App初始化时，获取权限列表，缓存到全局状态表中</li><li>按系统需要，按权限列表渲染出系统菜单</li><li>在路由跳转的时候，通过路由守护进行拦截，查询当前路由是否在权限列表对象（字段moduleUrl）中</li><li><strong>关键代码示例：</strong><strong>本地路由数据</strong></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 本地路由数据</span>
<span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/office-repair&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;OfficeRepair&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">component</span><span class="token operator">:</span> OfficeRepair
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">...</span><span class="token operator">...</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/office-item-detail&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;OfficeItemDetail&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">component</span><span class="token operator">:</span> OfficeItemDetail<span class="token punctuation">,</span>
  <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">public</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>路由劫持</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 路由守护</span>
route<span class="token punctuation">.</span><span class="token function-variable function">beforeEnter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 公有路由条目，不做权限控制（在路由表中标记）</span>
  <span class="token keyword">const</span> ignore <span class="token operator">=</span> to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>public
  <span class="token comment">// 状态管理中取出权限列表，当前路由是否在权限列表中</span>
  <span class="token keyword">const</span> <span class="token literal-property property">routePermis</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">[</span><span class="token string">&#39;global/routePermis&#39;</span><span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ignore <span class="token operator">||</span> routePermis<span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">Toast</span><span class="token punctuation">(</span><span class="token string">&#39;抱歉，您没有访问权限&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>PS：还可以通过路由过滤的方式将无权限的路由条目剔除，可根据需要自行实现</strong></p><h3 id="按钮控制" tabindex="-1"><a class="header-anchor" href="#按钮控制" aria-hidden="true">#</a> 按钮控制</h3><ul><li>App初始化时，给应用添加自定义指令获取权限列表，缓存到全局状态表中</li><li>按钮权限控制逻辑，以Vue为例，添加<code>v-aier-permis</code>自定义指令来实现</li><li><strong>关键代码示例：</strong></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">permis</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">binding</span><span class="token operator">:</span> DirectiveBinding<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 状态管理中取出按钮权限列表</span>
  <span class="token keyword">const</span> buttonPermis <span class="token operator">=</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">[</span><span class="token string">&#39;global/buttonPermis&#39;</span><span class="token punctuation">]</span>
  <span class="token comment">// 如果当前配置了权限指令值，并且不在权限列表中，从Dom中移除当前组件</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>code<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 多个权限值的情况</span>
    <span class="token operator">!</span>code<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token operator">=&gt;</span> buttonPermis<span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token operator">!</span>buttonPermis<span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token comment">// 导出安装方法</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">install</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">app</span><span class="token operator">:</span> App</span><span class="token punctuation">)</span><span class="token operator">:</span> App <span class="token punctuation">{</span>
    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">&#39;aier-permis&#39;</span><span class="token punctuation">,</span> permis<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>按钮或视图中使用户自定义指令（v-aier-permis），如：指令值为 <code>AmscpOfficeSwitchRole</code></li><li><strong>关键代码示例：</strong></li></ul><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// 通过arg参数</span>
<span class="token operator">&lt;</span>div v<span class="token operator">-</span>aier<span class="token operator">-</span>permis<span class="token operator">:</span>AmscpOfficeSwitchRole <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;role-switch&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;roleSwitch&quot;</span><span class="token operator">&gt;</span>
<span class="token comment">// 通过value赋值</span>
<span class="token operator">&lt;</span>div v<span class="token operator">-</span>aier<span class="token operator">-</span>permis<span class="token operator">=</span><span class="token string">&quot;&#39;AmscpOfficeSwitchRole&#39;&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;role-switch&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;roleSwitch&quot;</span><span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>又如示例：（1、自定义指定；2、自定义组件；3、页面逻辑）</strong><img src="`+l+'" alt="代码示例"></p>',21),i=[c];function u(k,d){return s(),a("div",null,i)}const m=n(r,[["render",u],["__file","1.vuepower.html.vue"]]);export{m as default};
